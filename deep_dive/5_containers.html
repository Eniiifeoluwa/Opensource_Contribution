<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Containers &mdash; Ivy 1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="icon" type="image/png" href="https://github.com/unifyai/unifyai.github.io/blob/master/img/externally_linked/ivy_logo_only.png?raw=true">
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Data Types" href="6_data_types.html" />
    <link rel="prev" title="Arrays" href="4_arrays.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Ivy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extensions.html">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../deep_dive.html">Deep Dive</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="0_navigating_the_code.html">Navigating the Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="1_function_types.html">Function Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_backend_setting.html">Backend Setting</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_function_wrapping.html">Function Wrapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="4_arrays.html">Arrays</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Containers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#container-instance-methods">Container Instance Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#container-static-methods">Container Static Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api-static-methods">API Static Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api-instance-methods">API Instance Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api-special-methods">API Special Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nestable-functions">Nestable Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="6_data_types.html">Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="7_devices.html">Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="8_inplace_updates.html">Inplace Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="9_function_arguments.html">Function Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="10_docstrings.html">Docstrings</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_docstring_examples.html">Docstring Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="12_array_api_tests.html">Array API Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="13_ivy_tests.html">Ivy Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../functional/frontends.html">Frontends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/activations.html">Activations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/compilation.html">Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/constants.html">Constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/creation.html">Creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/data_type.html">Data type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/device.html">Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/elementwise.html">Elementwise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/general.html">General</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/gradients.html">Gradients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/image.html">Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/layers.html">Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/linear_algebra.html">Linear algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/losses.html">Losses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/manipulation.html">Manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/meta.html">Meta</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/nest.html">Nest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/norms.html">Norms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/random.html">Random</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/searching.html">Searching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/set.html">Set</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/sorting.html">Sorting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/statistical.html">Statistical</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/utility.html">Utility</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Stateful</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../stateful/activations.html">Activations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/converters.html">Converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/initializers.html">Initializers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/layers.html">Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/module.html">Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/norms.html">Norms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/optimizers.html">Optimizers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/sequential.html">Sequential</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ivy"">Ivy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mech"">Ivy mech</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vision"">Ivy vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../robot"">Ivy robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gym"">Ivy gym</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../memory"">Ivy memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../builder"">Ivy builder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models"">Ivy models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystem"">Ivy ecosystem</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ivy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../contributing.html">Contributing</a> &raquo;</li>
          <li><a href="../deep_dive.html">Deep Dive</a> &raquo;</li>
      <li>Containers</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/deep_dive/5_containers.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="containers">
<h1>Containers<a class="headerlink" href="#containers" title="Permalink to this heading"></a></h1>
<p>The <a class="reference external" href="https://github.com/unifyai/ivy/blob/e47a7b18628aa73ba0c064d3d07352a7ab672bd1/ivy/container/container.py#L25">ivy.Container</a> inherits from <a class="reference external" href="https://github.com/unifyai/ivy/blob/e47a7b18628aa73ba0c064d3d07352a7ab672bd1/ivy/container/base.py#L56">dict</a>, and is useful for storing nested data.
For example, the container is equally suitable for storing batches of training data,
or for storing the weights of a network.</p>
<p>The methods of the <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> class are more varied than those of the <code class="code docutils literal notranslate"><span class="pre">ivy.Array</span></code>.
All methods of the <code class="code docutils literal notranslate"><span class="pre">ivy.Array</span></code> are instance methods,
and almost all of them directly wrap a function in the functional API.</p>
<p>For the <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code>, there are also methods which are specific to the container itself,
for performing nested operations on the leaves of the container for example.
In addition, there are also static methods.
Overall, this results in the following five mutually exclusive groups of <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> methods.
Each of these are explained in the following sub-sections.</p>
<ol class="arabic simple">
<li><p>Container instance methods</p></li>
<li><p>Container static methods</p></li>
<li><p>API instance methods</p></li>
<li><p>API special methods</p></li>
<li><p>API static methods</p></li>
</ol>
<section id="container-instance-methods">
<h2>Container Instance Methods<a class="headerlink" href="#container-instance-methods" title="Permalink to this heading"></a></h2>
<p>Container instance methods are methods which are specific to the container itself.
A few examples include <a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/base.py#L4030">ivy.Container.map</a> which is used for mapping a function to all leaves of the container,
<a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/base.py#L1490">ivy.Container.all_true</a> which determines if all container leaves evaluate to boolean <cite>True</cite>,
and <a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/base.py#L3019">ivy.Container.to_iterator</a> which returns an iterator for traversing the leaves of the container.</p>
<p>There are many more examples, check out the abstract <a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/base.py#L56">ContainerBase</a> class to see some more!</p>
</section>
<section id="container-static-methods">
<h2>Container Static Methods<a class="headerlink" href="#container-static-methods" title="Permalink to this heading"></a></h2>
<p>Container static methods are also methods which are specific to containers,
but which generally operate across <em>multiple</em> containers rather than a single container.
This underpins the decision to not bind these method to a single container instance,
and instead implement them as <em>static</em> methods.</p>
<p>A few examples include <a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/base.py#L593">ivy.Container.multi_map</a>
which is used for mapping a function to all leaves of <em>multiple</em> containers with the same nested structure,
<a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/base.py#L396">ivy.Container.diff</a> which displays the difference in nested structure between multiple containers,
and <a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/base.py#L663">ivy.Container.common_key_chains</a> which returns the nested structure that is common to all containers.</p>
<p>There are many more examples, check out the abstract <a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/base.py#L56">ContainerBase</a> class to see some more!</p>
</section>
<section id="api-static-methods">
<h2>API Static Methods<a class="headerlink" href="#api-static-methods" title="Permalink to this heading"></a></h2>
<p>Unlike the <code class="code docutils literal notranslate"><span class="pre">ivy.Array</span></code> class, the <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> also implements all functions in the functional API as
<em>static</em> methods. The main reason for this is to support the <em>nestable</em> property of all functions in the API,
which is explained in detail in the <a class="reference internal" href="1_function_types.html#function-types"><span class="std std-ref">Function Types</span></a> section.</p>
<p>To recap, what this means is that every function can arbitrarily accept <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> instances for <strong>any</strong>
of the arguments, and in such cases the function will automatically be mapped to the leaves of this container.
When multiple containers are passed, this mapping is only applied to their shared nested structure,
with the mapping applied to each of these leaves.</p>
<p>In such cases, the function in the functional API defers to this <em>static</em> <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> implementation.
Under the hood, <a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/base.py#L167">ivy.Container.multi_map_in_static_method</a> enables us to pass in arbitrary combinations of containers
and non-containers, and perform the correct mapping across the leaves.
Internally, <code class="code docutils literal notranslate"><span class="pre">ivy.Container.multi_map_in_static_method</span></code> calls <a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/base.py#L593">ivy.Container.multi_map</a>.
In cases where there are no containers passed,
<a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/base.py#L167">ivy.Container.multi_map_in_static_method</a> will simply call the function once on the non-container arguments provided.</p>
<p>A few examples of <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> API static methods are
<a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/elementwise.py#L71">ivy.Container.static_add</a>, <a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/elementwise.py#L1240">ivy.Container.static_tan</a> and <a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/manipulation.py#L135">ivy.Container.static_roll</a>.</p>
<p>As with <code class="code docutils literal notranslate"><span class="pre">ivy.Array</span></code>,
given the simple set of rules which underpin how these static methods should all be implemented,
if a source-code implementation is not found,
then this <a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/__init__.py#L199">static method is added</a> programmatically.
This serves as a helpful backup in cases where some static methods are accidentally missed out.</p>
<p>The benefit of the source code implementations is that this makes the code much more readable,
with important methods not being entirely absent from the code.
It also enables other helpful perks, such as auto-completions in the IDE etc.</p>
</section>
<section id="api-instance-methods">
<h2>API Instance Methods<a class="headerlink" href="#api-instance-methods" title="Permalink to this heading"></a></h2>
<p>The <em>API</em> instance methods serve a similar purpose to the instance methods of the <code class="code docutils literal notranslate"><span class="pre">ivy.Array</span></code> class.
They enable functions in Ivy’s functional API to be called as instance methods on the <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> class.
The difference is that with the <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code>,
the API function is applied recursively to all the leaves of the container.</p>
<p>Under the hood, every <em>instance</em> method calls the corresponding <em>static</em> method.
For example, <a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/elementwise.py#L92">ivy.Container.add</a> calls <code class="code docutils literal notranslate"><span class="pre">ivy.Container.static_add</span></code>,
<a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/elementwise.py#L1259">ivy.Container.tan</a> calls <code class="code docutils literal notranslate"><span class="pre">ivy.Container.static_tan</span></code>,
and <a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/manipulation.py#L158">ivy.Container.roll</a> calls <code class="code docutils literal notranslate"><span class="pre">ivy.Container.static_roll</span></code>.</p>
<p>As is the case for <code class="code docutils literal notranslate"><span class="pre">ivy.Array</span></code>,
the organization of these instance methods follows the same organizational structure as the
files in the functional API.
The <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> class <a class="reference external" href="https://github.com/unifyai/ivy/blob/8cbffbda9735cf16943f4da362ce350c74978dcb/ivy/container/container.py#L25">inherits</a> from many category-specific array classes,
such as <a class="reference external" href="https://github.com/unifyai/ivy/blob/8cbffbda9735cf16943f4da362ce350c74978dcb/ivy/container/elementwise.py#L12">ContainerWithElementwise</a>, each of which implement the category-specific instance methods.</p>
<p>Again, as with <code class="code docutils literal notranslate"><span class="pre">ivy.Array</span></code>,
given the simple set of rules which underpin how these instance methods should all be implemented,
if a source-code implementation is not found,
then this <a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/__init__.py#L173">instance method is added</a> programmatically.
Again, this serves as a helpful backup in cases where some static methods are accidentally missed out.</p>
<p>Again, the benefit of the source code implementations is that this makes the code much more readable,
with important methods not being entirely absent from the code.
It also enables other helpful perks, such as auto-completions in the IDE etc.</p>
</section>
<section id="api-special-methods">
<h2>API Special Methods<a class="headerlink" href="#api-special-methods" title="Permalink to this heading"></a></h2>
<p>As is the case for the <code class="code docutils literal notranslate"><span class="pre">ivy.Array</span></code>,
most special methods of the <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> simply wrap a corresponding function in the functional API.</p>
<p>The special methods which <strong>do not</strong> wrap functions in the functional API are implemented in <a class="reference external" href="https://github.com/unifyai/ivy/blob/8d1eef71522be7f98b601e5f97bb2c54142795b3/ivy/container/base.py#L56">ContainerBase</a>,
which is the base abstract class for all containers.
These special methods include
<a class="reference external" href="https://github.com/unifyai/ivy/blob/36e32ca1f17ef1e4c1b986599b45974156c19737/ivy/container/base.py#L4588">__repr__</a> which controls how the container is printed in the terminal,
<a class="reference external" href="https://github.com/unifyai/ivy/blob/36e32ca1f17ef1e4c1b986599b45974156c19737/ivy/container/base.py#L4782">__getattr__</a> that enables keys in the underlying <code class="code docutils literal notranslate"><span class="pre">dict</span></code> to be queried as attributes,
<a class="reference external" href="https://github.com/unifyai/ivy/blob/36e32ca1f17ef1e4c1b986599b45974156c19737/ivy/container/base.py#L4790">__setattr__</a> that enables attribute setting to update the underlying <code class="code docutils literal notranslate"><span class="pre">dict</span></code>,
<a class="reference external" href="https://github.com/unifyai/ivy/blob/36e32ca1f17ef1e4c1b986599b45974156c19737/ivy/container/base.py#L4842">__getitem__</a> that enables the underlying <code class="code docutils literal notranslate"><span class="pre">dict</span></code> to be queried via a chain of keys,
<a class="reference external" href="https://github.com/unifyai/ivy/blob/36e32ca1f17ef1e4c1b986599b45974156c19737/ivy/container/base.py#L4884">__setitem__</a> that enables the underlying <code class="code docutils literal notranslate"><span class="pre">dict</span></code> to be set via a chain of keys,
<a class="reference external" href="https://github.com/unifyai/ivy/blob/36e32ca1f17ef1e4c1b986599b45974156c19737/ivy/container/base.py#L4904">__contains__</a> that enables us to check for chains of keys in the underlying <code class="code docutils literal notranslate"><span class="pre">dict</span></code>,
and <a class="reference external" href="https://github.com/unifyai/ivy/blob/36e32ca1f17ef1e4c1b986599b45974156c19737/ivy/container/base.py#L4912">__getstate__</a> and <a class="reference external" href="https://github.com/unifyai/ivy/blob/36e32ca1f17ef1e4c1b986599b45974156c19737/ivy/container/base.py#L4927">__setstate__</a> which combined enable the container to be pickled and unpickled.</p>
<p>As for the special methods which <strong>do</strong> simply wrap corresponding functions in the functional API,
these are <a class="reference external" href="https://github.com/unifyai/ivy/blob/36e32ca1f17ef1e4c1b986599b45974156c19737/ivy/container/container.py#L98">implemented</a> in the main <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> class.</p>
<p>These special methods all directly wrap the corresponding API <em>static</em> <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> method.</p>
<p>Examples include <a class="reference external" href="https://github.com/unifyai/ivy/blob/36e32ca1f17ef1e4c1b986599b45974156c19737/ivy/container/container.py#L115">__add__</a>, <a class="reference external" href="https://github.com/unifyai/ivy/blob/36e32ca1f17ef1e4c1b986599b45974156c19737/ivy/container/container.py#L121">__sub__</a>, <a class="reference external" href="https://github.com/unifyai/ivy/blob/36e32ca1f17ef1e4c1b986599b45974156c19737/ivy/container/container.py#L127">__mul__</a> and <a class="reference external" href="https://github.com/unifyai/ivy/blob/36e32ca1f17ef1e4c1b986599b45974156c19737/ivy/container/container.py#L133">__truediv__</a> which directly call
<code class="code docutils literal notranslate"><span class="pre">ivy.Container.static_add</span></code>, <code class="code docutils literal notranslate"><span class="pre">ivy.Container.static_subtract</span></code>,
<code class="code docutils literal notranslate"><span class="pre">ivy.Container.static_multiply</span></code> and <code class="code docutils literal notranslate"><span class="pre">ivy.Container.static_divide</span></code> respectively.</p>
</section>
<section id="nestable-functions">
<h2>Nestable Functions<a class="headerlink" href="#nestable-functions" title="Permalink to this heading"></a></h2>
<p>As introduced in the <a class="reference internal" href="1_function_types.html#function-types"><span class="std std-ref">Function Types</span></a> section, most functions in Ivy are
<em>nestable</em>, which means that they can accept <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> instances in place
of <strong>any</strong> of the arguments.</p>
<p>Here, we expand on this explanation.
Please check out the explanation in the <a class="reference internal" href="1_function_types.html#function-types"><span class="std std-ref">Function Types</span></a> section first.</p>
<p><strong>Shared Nested Structure</strong></p>
<p>NOTE - implementing the behaviour for shared nested structures is a work in progress,
the master branch will soon support all of the examples given below, but not yet 🚧</p>
<p>When the nested structures of the multiple containers are <em>shared</em> but not <em>identical</em>,
then the behaviour of the nestable function is a bit different.
Containers have <em>shared</em> nested structures if all unique leaves in any of the containers
are children of a nested structure which is shared by all other containers.</p>
<p>Take the example below, the nested structures of containers <code class="code docutils literal notranslate"><span class="pre">x</span></code> and <code class="code docutils literal notranslate"><span class="pre">y</span></code>
are shared but not identical.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span> <span class="n">d</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>The shared key chains (chains of keys, used for indexing the container)
are <code class="code docutils literal notranslate"><span class="pre">a</span></code> and <code class="code docutils literal notranslate"><span class="pre">d</span></code>. The key chains unique to <code class="code docutils literal notranslate"><span class="pre">x</span></code> are <code class="code docutils literal notranslate"><span class="pre">a/b</span></code>, <code class="code docutils literal notranslate"><span class="pre">a/c</span></code>,
<code class="code docutils literal notranslate"><span class="pre">d/e</span></code> and <code class="code docutils literal notranslate"><span class="pre">d/f</span></code>. The unique key chains all share the same base structure as
all other containers (in this case only one other container, <code class="code docutils literal notranslate"><span class="pre">y</span></code>).
Therefore, the containers <code class="code docutils literal notranslate"><span class="pre">x</span></code> and <code class="code docutils literal notranslate"><span class="pre">y</span></code> have shared nested structure.</p>
<p>When calling <em>nestable</em> functions on containers with non-identical structure,
then the shared leaves of the shallowest container are broadcast to the leaves of the
deepest container.</p>
<p>It’s helpful to look at an example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">a</span><span class="p">:</span> <span class="p">{</span>
      <span class="n">b</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="n">c</span><span class="p">:</span> <span class="mi">2</span>
    <span class="p">},</span>
    <span class="n">d</span><span class="p">:</span> <span class="p">{</span>
      <span class="n">e</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="n">f</span><span class="p">:</span> <span class="mf">2.67</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this case, the integer at <code class="code docutils literal notranslate"><span class="pre">y.a</span></code> is broadcast to the leaves <code class="code docutils literal notranslate"><span class="pre">x.a.b</span></code> and
<code class="code docutils literal notranslate"><span class="pre">x.a.c</span></code>, and the integer at <code class="code docutils literal notranslate"><span class="pre">y.d</span></code> is broadcast to the leaves <code class="code docutils literal notranslate"><span class="pre">x.d.e</span></code>
and <code class="code docutils literal notranslate"><span class="pre">x.d.f</span></code>.</p>
<p>Another example of containers with shared nested structure is given below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span> <span class="n">d</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}},</span> <span class="n">d</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">})</span>
</pre></div>
</div>
<p>Adding these containers together would result in the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">a</span><span class="p">:</span> <span class="p">{</span>
      <span class="n">b</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
      <span class="n">c</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">g</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
        <span class="n">h</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="n">d</span><span class="p">:</span> <span class="p">{</span>
      <span class="n">e</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>
      <span class="n">f</span><span class="p">:</span> <span class="mi">25</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>An example of containers which <strong>do not</strong> have shared nested structure is given below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span> <span class="n">d</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}},</span> <span class="n">d</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">})</span>
</pre></div>
</div>
<p>This is for three reasons, (a) the key chain <code class="code docutils literal notranslate"><span class="pre">g</span></code> is not shared by any container other
than <code class="code docutils literal notranslate"><span class="pre">y</span></code>, (b) the key chain <code class="code docutils literal notranslate"><span class="pre">d/f</span></code> for <code class="code docutils literal notranslate"><span class="pre">x</span></code> is not present in
<code class="code docutils literal notranslate"><span class="pre">z</span></code> despite <code class="code docutils literal notranslate"><span class="pre">d</span></code> not being a non-leaf node in <code class="code docutils literal notranslate"><span class="pre">z</span></code>,
and likewise the key chain <code class="code docutils literal notranslate"><span class="pre">d/g</span></code> for <code class="code docutils literal notranslate"><span class="pre">z</span></code> is not present in <code class="code docutils literal notranslate"><span class="pre">x</span></code>
despite <code class="code docutils literal notranslate"><span class="pre">d</span></code> not being a non-leaf node in <code class="code docutils literal notranslate"><span class="pre">x</span></code>.</p>
<p><strong>Container-dependent Functions</strong></p>
<p><em>Container-dependent</em> functions are functions containing arguments which, if provided,
<strong>must</strong> be provided as an <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code>.
<em>Container-dependent</em> functions are never <em>nestable</em>, as we will explain.
Due to their dependence on containers, <em>container-dependent</em> functions all have a natural
many (the containers) to one (all other arguments) correspondence in the arguments,
unlike <em>nestable</em> functions which have a one-to-one correspondence between the arguments
by default.</p>
<p>A couple of examples of <em>Container-dependent</em> functions are:
<code class="code docutils literal notranslate"><span class="pre">ivy.execute_with_gradients</span></code> and <code class="code docutils literal notranslate"><span class="pre">ivy.multi_head_attention</span></code>.</p>
<p>We’ll go through the signatures and docstring descriptions for both of these in turn.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">execute_with_gradients</span><span class="p">(</span>
    <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">xs</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span>
    <span class="n">retain_grads</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call function func with container of input variables xs, and return the</span>
<span class="sd">    functions first output y, the gradients dy/dx as a new container, and any other</span>
<span class="sd">    function outputs after the returned y value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Technically, this function <em>could</em> be made fully nestable, whereby the function would
be independently applied on each leaf node of the <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> of variables,
but this would be much less efficient, with the backend autograd function
(such as <code class="code docutils literal notranslate"><span class="pre">torch.autograd.grad</span></code>) being called many times independently for each
variable in the container of variables <code class="code docutils literal notranslate"><span class="pre">xs</span></code>. By making this function non-nestable,
we do not map the function across each of the container leaves, and instead pass the
entire container into the backend autograd function directly,
which is much more efficient.</p>
<p>If the function were <em>nestable</em>, it would also repeatedly return <code class="code docutils literal notranslate"><span class="pre">y</span></code> and all
other function return values at each leaf of the single returned container,
changing the signature of the function, and causing repeated redundancy in the return.</p>
<p>The example <code class="code docutils literal notranslate"><span class="pre">ivy.multi_head_attention</span></code> is a bit different.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multi_head_attention</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">NativeArray</span><span class="p">],</span>
    <span class="n">scale</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
    <span class="n">num_heads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">NativeArray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mask</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">NativeArray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_q_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_kv_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_out_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_q_v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_kv_v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_out_v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies multi-head attention, with the array (x) to determine the queries from,</span>
<span class="sd">    the scale for the query-key similarity measure, the number of</span>
<span class="sd">    attention heads, the context to determine the keys and values from,</span>
<span class="sd">    the mask to apply to the query-key values, the function (to_q_fn) to compute</span>
<span class="sd">    queries from input x, the function (to_kv_fn) to compute keys and values from</span>
<span class="sd">    the context, the function (to_out_fn) to compute the output from the scaled</span>
<span class="sd">    dot-product attention, the variables (to_q_v) for function to_q_fn, the</span>
<span class="sd">    variables (to_kv_v) for function to_kv_fn, and the variables (to_out_v) for</span>
<span class="sd">    function to_out_fn.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>This function fundamentally could not be made <em>nestable</em>,
as the function takes a many-to-one approach with regards to the optional containers:
<code class="code docutils literal notranslate"><span class="pre">to_q_v</span></code>, <code class="code docutils literal notranslate"><span class="pre">to_kv_v</span></code> and <code class="code docutils literal notranslate"><span class="pre">to_out_v</span></code>.
The containers are optionally used for the purpose of returning a single
<code class="code docutils literal notranslate"><span class="pre">ivy.Array</span></code> at the end. Calling this function on each leaf of the containers
passed in the input would not make any sense.</p>
<p>Hopefully, these two examples explain why <em>Container-dependent</em> functions
(with arguments which, if provided, <strong>must</strong> be provided as an <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code>),
are never implemented as <em>nestable</em> functions.</p>
<p><strong>Implicitly Nestable Functions</strong></p>
<p>The <em>nestable</em> behaviour is added to any function which is decorated with the
<a class="reference external" href="https://github.com/unifyai/ivy/blob/5f58c087906a797b5cb5603714d5e5a532fc4cd4/ivy/func_wrapper.py#L407">handle_nestable</a>
wrapper. This wrapper causes the function to be applied at each leaf of any containers
passed in the input. For <em>compositional</em> functions which are composed of other nestable
functions, then this compositional function is already <strong>implicitly nestable</strong>,
without us needing to explicitly wrap it at all.</p>
<p>Let’s take the function <code class="code docutils literal notranslate"><span class="pre">ivy.cross_entropy</span></code> as an example.
The internally called functions are: <code class="code docutils literal notranslate"><span class="pre">ivy.clip</span></code>, <code class="code docutils literal notranslate"><span class="pre">ivy.log</span></code>, <code class="code docutils literal notranslate"><span class="pre">ivy.sum</span></code>
and <code class="code docutils literal notranslate"><span class="pre">ivy.negative</span></code>, each of which are themselves <em>nestable</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cross_entropy</span><span class="p">(</span>
    <span class="n">true</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">NativeArray</span><span class="p">],</span>
    <span class="n">pred</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">NativeArray</span><span class="p">],</span>
    <span class="n">axis</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">epsilon</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-7</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">)</span>
    <span class="n">log_pred</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ivy</span><span class="o">.</span><span class="n">negative</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">log_pred</span> <span class="o">*</span> <span class="n">true</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">),</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p>Therefore, when passing an <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> instance in the input,
each internal function will, in turn, correctly handle the container, and return
a new container with the correct operations having been performed. This makes it very
easy and intuitive to debug the code, as the code is stepped through chronologically.
In effect, all leaves of the input container are being processed concurrently,
during the computation steps of the <code class="code docutils literal notranslate"><span class="pre">ivy.cross_entropy</span></code> function.</p>
<p>However, what if we had added the
<a class="reference external" href="https://github.com/unifyai/ivy/blob/5f58c087906a797b5cb5603714d5e5a532fc4cd4/ivy/func_wrapper.py#L407">handle_nestable</a>
wrapping as a decorator directly to the function <code class="code docutils literal notranslate"><span class="pre">ivy.cross_entropy</span></code>?</p>
<p>In this case, the <code class="code docutils literal notranslate"><span class="pre">ivy.cross_entropy</span></code> function would itself be called
multiple times, on each of the leaves of the container.
The functions <code class="code docutils literal notranslate"><span class="pre">ivy.clip</span></code>, <code class="code docutils literal notranslate"><span class="pre">ivy.log</span></code>, <code class="code docutils literal notranslate"><span class="pre">ivy.sum</span></code>
and <code class="code docutils literal notranslate"><span class="pre">ivy.negative</span></code> would each only consume and return arrays,
and debugging the <code class="code docutils literal notranslate"><span class="pre">ivy.cross_entropy</span></code> function
would then become less intuitively chronological,
with each leaf of the input container now processed sequentially,
rather than concurrently.</p>
<p>Therefore, our approach is to <strong>not</strong> wrap any compositional functions which are
already <em>implicitly nestable</em> as a result of the <em>nestable</em> functions called internally.</p>
<p>There may be some compositional functions which are not implicitly nestable for some
reason, and in such cases adding the explicit
<a class="reference external" href="https://github.com/unifyai/ivy/blob/5f58c087906a797b5cb5603714d5e5a532fc4cd4/ivy/func_wrapper.py#L407">handle_nestable</a>
wrapping may be necessary. But we should try to avoid this,
in order to make the flow of computation as intuitive to the user as possible.</p>
<p>When compiling the code, the computation graph is <strong>identical</strong> in either case,
and there will be no implications on performance whatsoever.
The implicit nestable solution may be slightly less efficient in eager mode,
as the leaves of the container are traversed multiple times rather than once,
but if performance is of concern then the code should always be compiled in any case.
The distinction is only really relevant when stepping through and debugging with eager
mode execution, and for the reasons outlined above, the preference is to keep
compositional implicitly nestable where possible.</p>
<p><strong>Round Up</strong></p>
<p>This should have hopefully given you a good feel for containers, and how these are handled in Ivy.</p>
<p>If you’re ever unsure of how best to proceed,
please feel free to engage with the <a class="reference external" href="https://github.com/unifyai/ivy/discussions/1316">containers discussion</a>,
or reach out on <a class="reference external" href="https://discord.gg/ZVQdvbzNQJ">discord</a> in the <a class="reference external" href="https://discord.com/channels/799879767196958751/982738042886422598">containers channel</a>!</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="4_arrays.html" class="btn btn-neutral float-left" title="Arrays" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="6_data_types.html" class="btn btn-neutral float-right" title="Data Types" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2022, Ivy Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>