<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ivy Container &mdash; Ivy 1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="icon" type="image/png" href="https://github.com/unifyai/unifyai.github.io/blob/master/img/externally_linked/ivy_logo_only.png?raw=true">
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Ivy Stateful API" href="ivy_stateful_api.html" />
    <link rel="prev" title="Ivy as a Framework" href="../ivy_as_a_framework.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Ivy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../background.html">Background</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../design.html">Design</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../building_blocks.html">Building Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ivy_as_a_transpiler.html">Ivy as a Transpiler</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../ivy_as_a_framework.html">Ivy as a Framework</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Ivy Container</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#construction">Construction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#representation">Representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#recursive-methods">Recursive Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#built-ins">Built-ins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access">Access</a></li>
<li class="toctree-l4"><a class="reference internal" href="#saving-and-loading">Saving and Loading</a></li>
<li class="toctree-l4"><a class="reference internal" href="#comparisons">Comparisons</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customized-representations">Customized Representations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#use-cases">Use Cases</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compartmentalization">Compartmentalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-loading">Data loading</a></li>
<li class="toctree-l4"><a class="reference internal" href="#network-weights">Network weights</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ivy_stateful_api.html">Ivy Stateful API</a></li>
<li class="toctree-l3"><a class="reference internal" href="ivy_array.html">Ivy Array</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../extensions.html">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deep_dive.html">Deep Dive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../functional/frontends.html">Frontends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/activations.html">Activations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/compilation.html">Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/constants.html">Constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/creation.html">Creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/data_type.html">Data type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/device.html">Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/elementwise.html">Elementwise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/general.html">General</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/gradients.html">Gradients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/image.html">Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/layers.html">Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/linear_algebra.html">Linear algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/losses.html">Losses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/manipulation.html">Manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/meta.html">Meta</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/nest.html">Nest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/norms.html">Norms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/random.html">Random</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/searching.html">Searching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/set.html">Set</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/sorting.html">Sorting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/statistical.html">Statistical</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functional/ivy/utility.html">Utility</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Stateful</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../stateful/activations.html">Activations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stateful/converters.html">Converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stateful/initializers.html">Initializers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stateful/layers.html">Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stateful/module.html">Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stateful/norms.html">Norms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stateful/optimizers.html">Optimizers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stateful/sequential.html">Sequential</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ivy"">Ivy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mech"">Ivy mech</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../vision"">Ivy vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../robot"">Ivy robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gym"">Ivy gym</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory"">Ivy memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../builder"">Ivy builder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models"">Ivy models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecosystem"">Ivy ecosystem</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ivy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../design.html">Design</a> &raquo;</li>
          <li><a href="../ivy_as_a_framework.html">Ivy as a Framework</a> &raquo;</li>
      <li>Ivy Container</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/design/ivy_as_a_framework/ivy_container.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ivy-container">
<h1>Ivy Container<a class="headerlink" href="#ivy-container" title="Permalink to this heading"></a></h1>
<p>Here, we explain how the <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> class saves you a ton of time and cleans up code in almost all aspects of your ML workflow. So without further ado, let’s dive in!</p>
<p>Firstly, Dictionaries are an incredibly powerful and useful data type in Python. They enable a clean, readable and efficient-access (via hashing) storage of arbitrarily hierarchical data.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> class can be seen as a souped-up Dict, with many useful features built on top. It’s the backbone of most high level operations in Ivy.</p>
<p>Let’s walk through some of the most important features of the <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code>!</p>
<section id="construction">
<h2>Construction<a class="headerlink" href="#construction" title="Permalink to this heading"></a></h2>
<p>A container can be constructed in a number of ways. All construction approaches below result in identical <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> instances.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ivy</span>
<span class="n">ivy</span><span class="o">.</span><span class="n">set_framework</span><span class="p">(</span><span class="s1">&#39;torch&#39;</span><span class="p">)</span>

 <span class="n">dct</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]),</span>
        <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">]),</span>
              <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.</span><span class="p">])}}</span>

<span class="c1"># via dict</span>
<span class="n">cnt</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span>

<span class="c1"># via keyword</span>
<span class="n">cnt</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]),</span>
                    <span class="n">b</span><span class="o">=</span><span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">]),</span>
                                    <span class="n">d</span><span class="o">=</span><span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.</span><span class="p">])))</span>

<span class="c1"># combos</span>
<span class="n">cnt</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]),</span>
                    <span class="n">b</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">]),</span>
                       <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.</span><span class="p">])})</span>

<span class="n">cnt</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]),</span>
                     <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">]),</span>
                                        <span class="n">d</span><span class="o">=</span><span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.</span><span class="p">]))})</span>
</pre></div>
</div>
</section>
<section id="representation">
<h2>Representation<a class="headerlink" href="#representation" title="Permalink to this heading"></a></h2>
<p><code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> prints the hierarchical structure to the terminal in a very intuitive manner, much more so than native Python Dicts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span>

<span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span>
<span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">),</span> <span class="s1">&#39;</span>
<span class="n">d</span><span class="s1">&#39;: tensor([2.], device=&#39;</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="s1">&#39;)}}</span>

<span class="nb">print</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>

<span class="p">{</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">b</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">c</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">d</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">2.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the container holds very large arrays, then their shapes are printed instead. Again, this does not happen with native Python Dicts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dct</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
       <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)),</span>
             <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2</span><span class="p">))}}</span>

<span class="nb">print</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span>

<span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span>
<span class="p">:</span> <span class="n">tensor</span><span class="p">([[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="o">...</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="o">...</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="o">...</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;c</span>
<span class="n">uda</span><span class="p">:</span><span class="mi">0</span><span class="s1">&#39;), &#39;</span><span class="n">d</span><span class="s1">&#39;: tensor([[1., 1.],</span>
        <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">)}}</span>

<span class="n">cnt</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>

<span class="p">{</span>
    <span class="n">a</span><span class="p">:</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="o">&gt;</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span>
    <span class="n">b</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">c</span><span class="p">:</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="o">&gt;</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]),</span>
        <span class="n">d</span><span class="p">:</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="o">&gt;</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="recursive-methods">
<h2>Recursive Methods<a class="headerlink" href="#recursive-methods" title="Permalink to this heading"></a></h2>
<p>All methods in Ivy’s functional API are implemented as recursive methods on the <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code>. This means you can easily map a single method to all arrays in the container with a single line.</p>
<p>Starting with the following container:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cnt</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]),</span>
                     <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">]),</span>
                           <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">])}})</span>
</pre></div>
</div>
<p>We can compute the mean of each sub-array:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cnt</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">())</span>

<span class="p">{</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">b</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">c</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">4.3333</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">d</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">5.6667</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Or we can flip each sub-array:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cnt</span><span class="o">.</span><span class="n">flip</span><span class="p">())</span>

<span class="p">{</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">b</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">c</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">d</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>There are 178 such functions for the <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> class in total, check out the <a class="reference external" href="https://github.com/unifyai/ivy/blob/master/ivy/container.py">code</a> or <a class="reference external" href="https://lets-unify.ai/ivy/core/container.html">docs</a> to see what they are!</p>
</section>
<section id="built-ins">
<h2>Built-ins<a class="headerlink" href="#built-ins" title="Permalink to this heading"></a></h2>
<p>All built-in methods also apply recursively. For example, performing a gradient update step for a set of network weights can be done in one line.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span>
       <span class="p">{</span><span class="s1">&#39;linear&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">]),</span>
                   <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])}})</span>

<span class="n">grads</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span>
       <span class="p">{</span><span class="s1">&#39;linear&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.4</span><span class="p">]),</span>
                   <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.9</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">])}})</span>

<span class="n">lr</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">new_weights</span> <span class="o">=</span> <span class="n">weights</span> <span class="o">-</span> <span class="n">grads</span> <span class="o">*</span> <span class="n">lr</span>
<span class="nb">print</span><span class="p">(</span><span class="n">new_weights</span><span class="p">)</span>

<span class="p">{</span>
    <span class="n">linear</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">b</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.0600</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">w</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">1.3100</span><span class="p">,</span> <span class="mf">2.2400</span><span class="p">,</span> <span class="mf">0.6900</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Check out the section below on Ivy’s stateful API to see how the <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> is used for storing all network weights in <code class="code docutils literal notranslate"><span class="pre">ivy.Module</span></code> instances!</p>
</section>
<section id="access">
<h2>Access<a class="headerlink" href="#access" title="Permalink to this heading"></a></h2>
<p>The keys in an <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> can be set and accessed by using either class attributes or keys in the dictionary. Both of these setting and accessing approaches are equivalent under the hood.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cnt</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">])})</span>

<span class="n">cnt</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">])</span>
<span class="n">cnt</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>

<span class="p">{</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">c</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">2.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">assert</span> <span class="n">cnt</span><span class="o">.</span><span class="n">c</span> <span class="ow">is</span> <span class="n">cnt</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Nested keys can also be set in one line, using either ‘/’ or ‘.’ as a delimiter.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cnt</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">])})</span>
<span class="n">cnt</span><span class="p">[</span><span class="s1">&#39;b/c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">])</span>
<span class="n">cnt</span><span class="p">[</span><span class="s1">&#39;d.e.f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>

<span class="p">{</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">b</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">c</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">d</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">e</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">f</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">2.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>One of the key benefits of using properties under the hood is the autocomplete support this introduces. Class attributes can be auto-completed when pressing tab midway through typing. This is not possible with Dicts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cnt</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">({</span><span class="s1">&#39;agent&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;total_speed&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">])}})</span>
<span class="n">cnt</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">total_height</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">])</span>
<span class="n">cnt</span><span class="p">[</span><span class="s1">&#39;agent/total_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.</span><span class="p">])</span>

<span class="n">cnt</span><span class="o">.</span><span class="n">age</span> <span class="o">-&gt;</span> <span class="n">tab</span>
<span class="n">cnt</span><span class="o">.</span><span class="n">agent</span>
<span class="n">cnt</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">tot</span> <span class="o">-&gt;</span> <span class="n">tab</span>
<span class="n">cnt</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">total_</span> <span class="o">-&gt;</span> <span class="n">tab</span>

<span class="n">cnt</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">total_height</span>  <span class="n">cnt</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">total_speed</span>   <span class="n">cnt</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">total_width</span>

<span class="n">cnt</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">total_h</span> <span class="o">-&gt;</span> <span class="n">tab</span>
<span class="n">cnt</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">total_height</span>

<span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="saving-and-loading">
<h2>Saving and Loading<a class="headerlink" href="#saving-and-loading" title="Permalink to this heading"></a></h2>
<p>Saving and loading to disk can be done in one of many ways, with each being suited to different data types in the container.</p>
<p>For example, if the container mainly contains arrays (such as the weights of a network), then one of the following can be used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span>
       <span class="p">{</span><span class="s1">&#39;linear&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.2</span><span class="p">]]),</span>
                   <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]])}})</span>

<span class="c1"># save and load as hdf5</span>
<span class="n">weights</span><span class="o">.</span><span class="n">to_disk_as_hdf5</span><span class="p">(</span><span class="s1">&#39;weights.hdf5&#39;</span><span class="p">)</span>
<span class="n">loaded</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="o">.</span><span class="n">from_disk_as_hdf5</span><span class="p">(</span><span class="s1">&#39;weights.hdf5&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="o">.</span><span class="n">identical</span><span class="p">(</span>
       <span class="p">[</span><span class="n">loaded</span><span class="p">,</span> <span class="n">weights</span><span class="p">],</span> <span class="n">same_arrays</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># save and load as pickled</span>
<span class="n">weights</span><span class="o">.</span><span class="n">to_disk_as_pickled</span><span class="p">(</span><span class="s1">&#39;weights.pickled&#39;</span><span class="p">)</span>
<span class="n">loaded</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="o">.</span><span class="n">from_disk_as_pickled</span><span class="p">(</span><span class="s1">&#39;weights.pickled&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="o">.</span><span class="n">identical</span><span class="p">(</span>
       <span class="p">[</span><span class="n">loaded</span><span class="p">,</span> <span class="n">weights</span><span class="p">],</span> <span class="n">same_arrays</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, if the container mainly stored experiment configuration data, then the following can be used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span>
       <span class="p">{</span><span class="s1">&#39;loading&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;batch_size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
                    <span class="s1">&#39;dir&#39;</span><span class="p">:</span> <span class="s1">&#39;/dataset/images&#39;</span><span class="p">},</span>
        <span class="s1">&#39;training&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dropout&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="s1">&#39;lr&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
                     <span class="s1">&#39;optim&#39;</span><span class="p">:</span> <span class="s1">&#39;ADAM&#39;</span><span class="p">}})</span>

<span class="c1"># save and load as json</span>
<span class="n">config</span><span class="o">.</span><span class="n">to_disk_as_json</span><span class="p">(</span><span class="s1">&#39;config.json&#39;</span><span class="p">)</span>

<span class="c1"># config.json contents -------------#</span>
<span class="c1"># {                                 #</span>
<span class="c1">#     &quot;loading&quot;: {                  #</span>
<span class="c1">#         &quot;batch_size&quot;: 16,         #</span>
<span class="c1">#         &quot;dir&quot;: &quot;/dataset/images&quot;  #</span>
<span class="c1">#     },                            #</span>
<span class="c1">#     &quot;training&quot;: {                 #</span>
<span class="c1">#         &quot;dropout&quot;: true,          #</span>
<span class="c1">#         &quot;lr&quot;: 0.1,                #</span>
<span class="c1">#         &quot;optim&quot;: &quot;ADAM&quot;           #</span>
<span class="c1">#     }                             #</span>
<span class="c1"># }                                 #</span>
<span class="c1"># ----------------------------------#</span>

<span class="n">loaded</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="o">.</span><span class="n">from_disk_as_json</span><span class="p">(</span><span class="s1">&#39;config.json&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">config</span> <span class="o">==</span> <span class="n">loaded</span><span class="p">)</span><span class="o">.</span><span class="n">all_true</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="comparisons">
<h2>Comparisons<a class="headerlink" href="#comparisons" title="Permalink to this heading"></a></h2>
<p>Comparing differences between containers can be achieved on a per-leaf basis. This is useful for debugging and also comparing configurations between runs. For example, consider a case where two containers of arrays should be identical at all levels. We can then very quickly find conflicting leaves.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cnt0</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]),</span>
                   <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">])})</span>
<span class="n">cnt1</span> <span class="o">=</span> <span class="n">cnt0</span><span class="o">.</span><span class="n">deep_copy</span><span class="p">()</span>
<span class="n">cnt1</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cnt0</span><span class="p">,</span> <span class="n">cnt1</span><span class="p">))</span>

<span class="p">{</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">b</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">diff_0</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">diff_1</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Or perhaps we saved JSON configuration files to disk for two different experiment runs, and then want to quickly see their differences. The <code class="code docutils literal notranslate"><span class="pre">ivy.Container.diff</span></code> method will also detect differences in the hierarchical structure and key name differences.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">config0</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span>
       <span class="p">{</span><span class="s1">&#39;batch_size&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="s1">&#39;lr&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="s1">&#39;optim&#39;</span><span class="p">:</span> <span class="s1">&#39;ADAM&#39;</span><span class="p">})</span>

<span class="n">config1</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span>
       <span class="p">{</span><span class="s1">&#39;batch_size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
        <span class="s1">&#39;dropout&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s1">&#39;lr&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">config0</span><span class="p">,</span> <span class="n">config1</span><span class="p">))</span>

<span class="p">{</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">diff_0</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="n">diff_1</span><span class="p">:</span> <span class="mi">16</span>
    <span class="p">},</span>
    <span class="n">dropout</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">diff_1</span><span class="p">:</span> <span class="mf">0.5</span>
    <span class="p">},</span>
    <span class="n">lr</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">optim</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">diff_0</span><span class="p">:</span> <span class="n">ADAM</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">ivy.Container.diff</span></code> method can be applied to arbitrarily many containers at once in a single call, not just two as in the examples above.</p>
</section>
<section id="customized-representations">
<h2>Customized Representations<a class="headerlink" href="#customized-representations" title="Permalink to this heading"></a></h2>
<p>Not only does <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> print to the terminal in a very intuitive manner, but there are also helper functions to fully control this representation. This is very helpful when debugging networks with huge numbers of parameters with a deep hierarchical structure for example.</p>
<p>If our networks weights go many levels deep in the nested hierarchy, we might not want to see all of them when printing our container to screen. Consider the following nested structure.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;decoder&#39;</span><span class="p">:</span>
         <span class="p">{</span><span class="s1">&#39;l0&#39;</span><span class="p">:</span>
              <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]),</span>
               <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]])},</span>
          <span class="s1">&#39;l1&#39;</span><span class="p">:</span>
              <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]),</span>
               <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]])}},</span>
     <span class="s1">&#39;encoder&#39;</span><span class="p">:</span>
         <span class="p">{</span><span class="s1">&#39;l0&#39;</span><span class="p">:</span>
              <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]),</span>
               <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]])},</span>
          <span class="s1">&#39;l1&#39;</span><span class="p">:</span>
              <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]),</span>
               <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]])}},</span>
     <span class="s1">&#39;l0&#39;</span><span class="p">:</span>
         <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]),</span>
          <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]])},</span>
     <span class="s1">&#39;l1&#39;</span><span class="p">:</span>
         <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]),</span>
          <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]])}})</span>
</pre></div>
</div>
<p>We can clip the depth of the printed container in order to make the structure of the root keys clearer. All nested structures below this depth are truncated into single keys with a “__” delimiter appending all keys below this depth.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span><span class="o">.</span><span class="n">flatten_key_chains</span><span class="p">(</span><span class="n">above_height</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="p">{</span>
    <span class="n">decoder__l0</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">b</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">w</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">decoder__l1</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">b</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">w</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">encoder__l0</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">b</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">w</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">encoder__l1</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">b</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">w</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">l0</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">b</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">w</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">l1</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">b</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">w</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Likewise, we can clip the height of the printed container in order to make the structure of the leaf keys clearer. All nested structures above this height are truncated into single keys with a “__” delimiter appending all keys above this height.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span><span class="o">.</span><span class="n">flatten_key_chains</span><span class="p">(</span><span class="n">below_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="p">{</span>
    <span class="n">decoder</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">l0__b</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">l0__w</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">l1__b</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">l1__w</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">encoder</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">l0__b</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">l0__w</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">l1__b</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">l1__w</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">l0</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">b</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">w</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">l1</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">b</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">w</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These are very useful methods when stepping through code and debugging complex nested structures such as the weights of a network.</p>
<p>There are also methods: <code class="code docutils literal notranslate"><span class="pre">with_print_limit</span></code> for controlling the printable size of arrays before the shape is instead displayed, <code class="code docutils literal notranslate"><span class="pre">with_key_length_limit</span></code> for setting the maximum key length before string clipping, <code class="code docutils literal notranslate"><span class="pre">with_print_indent</span></code> for controlling the nested indent, and many more. Check out the <a class="reference external" href="https://lets-unify.ai/ivy/core/container.html">docs</a> for more details!</p>
</section>
<section id="use-cases">
<h2>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading"></a></h2>
<p>We’ll now just go through a few of the different use cases for the Ivy Container. The container is not limited to these use cases though, the container is the right choice whenever you are storing nested data!</p>
</section>
<section id="compartmentalization">
<h2>Compartmentalization<a class="headerlink" href="#compartmentalization" title="Permalink to this heading"></a></h2>
<p>The most obvious use case for the <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> class is to compartmentalize inputs into a useful structure. For example, without better foresight, we could untidily implement a function <code class="code docutils literal notranslate"><span class="pre">update_agent</span></code> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normalize_img</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
    <span class="n">img_max</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">reduce_max</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">img_min</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">reduce_min</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">img_range</span> <span class="o">=</span> <span class="n">img_max</span> <span class="o">-</span> <span class="n">img_min</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">img</span> <span class="o">-</span> <span class="n">img_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">img_range</span>

<span class="k">def</span> <span class="nf">update_agent</span><span class="p">(</span><span class="n">agent_position</span><span class="p">,</span> <span class="n">agent_velocity</span><span class="p">,</span>
                 <span class="n">agent_cam_front_rgb</span><span class="p">,</span> <span class="n">agent_cam_front_depth</span><span class="p">,</span>
                 <span class="n">agent_cam_rear_rgb</span><span class="p">,</span> <span class="n">agent_cam_rear_depth</span><span class="p">,</span>
                 <span class="n">agent_cam_lidar</span><span class="p">):</span>

    <span class="c1"># update agent state</span>
    <span class="n">agent_position</span> <span class="o">+=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">])</span>
    <span class="n">agent_velocity</span> <span class="o">-=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>

    <span class="c1"># normalize images</span>
    <span class="n">agent_cam_front_rgb</span> <span class="o">=</span> <span class="n">normalize_img</span><span class="p">(</span><span class="n">agent_cam_front_rgb</span><span class="p">)</span>
    <span class="n">agent_cam_front_depth</span> <span class="o">=</span> <span class="n">normalize_img</span><span class="p">(</span><span class="n">agent_cam_front_depth</span><span class="p">)</span>
    <span class="n">agent_cam_rear_rgb</span> <span class="o">=</span> <span class="n">normalize_img</span><span class="p">(</span><span class="n">agent_cam_rear_rgb</span><span class="p">)</span>
    <span class="n">agent_cam_rear_depth</span> <span class="o">=</span> <span class="n">normalize_img</span><span class="p">(</span><span class="n">agent_cam_rear_depth</span><span class="p">)</span>
    <span class="n">agent_cam_lidar</span> <span class="o">=</span> <span class="n">normalize_img</span><span class="p">(</span><span class="n">agent_cam_lidar</span><span class="p">)</span>

    <span class="c1"># return</span>
    <span class="k">return</span> <span class="n">agent_position</span><span class="p">,</span> <span class="n">agent_velocity</span><span class="p">,</span> <span class="n">agent_cam_front_rgb</span><span class="p">,</span>\
           <span class="n">agent_cam_front_depth</span><span class="p">,</span> <span class="n">agent_cam_rear_rgb</span><span class="p">,</span>\
           <span class="n">agent_cam_rear_depth</span><span class="p">,</span> <span class="n">agent_cam_lidar</span>
</pre></div>
</div>
<p>Our code will be much cleaner if we do something like the following, particularly if there are many additional similar functions performing operations on the agent and the images:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Cameras</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">front_rgb</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">front_depth</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
                 <span class="n">rear_rgb</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">rear_depth</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
                 <span class="n">lidar</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">front</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rgb&#39;</span><span class="p">:</span> <span class="n">front_rgb</span><span class="p">,</span>
                                <span class="s1">&#39;depth&#39;</span><span class="p">:</span> <span class="n">front_depth</span><span class="p">},</span>
                         <span class="n">rear</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rgb&#39;</span><span class="p">:</span> <span class="n">rear_rgb</span><span class="p">,</span>
                               <span class="s1">&#39;depth&#39;</span><span class="p">:</span> <span class="n">rear_depth</span><span class="p">},</span>
                         <span class="n">lidar</span><span class="o">=</span><span class="n">lidar</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Agent</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
                 <span class="n">velocity</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">cams</span><span class="p">:</span> <span class="n">Cameras</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
                         <span class="n">velocity</span><span class="o">=</span><span class="n">velocity</span><span class="p">,</span> <span class="n">cams</span><span class="o">=</span><span class="n">cams</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">update_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">):</span>

    <span class="c1"># update agent state</span>
    <span class="n">agent</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">])</span>
    <span class="n">agent</span><span class="o">.</span><span class="n">velocity</span> <span class="o">-=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>

    <span class="c1"># normalize images</span>
    <span class="n">cam_max</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">cams</span><span class="o">.</span><span class="n">reduce_max</span><span class="p">()</span>
    <span class="n">cam_min</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">cams</span><span class="o">.</span><span class="n">reduce_min</span><span class="p">()</span>
    <span class="n">cam_range</span> <span class="o">=</span> <span class="n">cam_max</span> <span class="o">-</span> <span class="n">cam_min</span>
    <span class="n">agent</span><span class="o">.</span><span class="n">cams</span> <span class="o">=</span> <span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">cams</span> <span class="o">-</span> <span class="n">cam_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">cam_range</span>
</pre></div>
</div>
<p>Of course, this argument holds for the use of custom classes or built-in containers (Python list, dict, tuple etc.), and isn’t only relevant for the Ivy container. However the recursive methods of the Ivy Container make things even more convenient, such as where we recursively normalize all five images in the final four lines of the <code class="code docutils literal notranslate"><span class="pre">update_agent</span></code> method.</p>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>As briefly alluded to when explaining the <code class="code docutils literal notranslate"><span class="pre">ivy.Container.diff</span></code> method, the container class is also the ideal data type for storing experiment configurations. Configurations can either first be stored to disk as a JSON file and then loaded into the <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> for recursive comparisons to see differences between experiments, or the config can be specified in the code and then saved to disk as a JSON to keep a permanent log afterwards.</p>
</section>
<section id="data-loading">
<h2>Data loading<a class="headerlink" href="#data-loading" title="Permalink to this heading"></a></h2>
<p>The container can also be used for data loading. Our example uses single threaded loading, but incorporating multiprocessing with Queues is also pretty straightforward.</p>
<p>To start with, let’s assume we have an image Dataset saved to disk with separate images for a front camera and a rear camera for each point in time.</p>
<p>We can then load this Dataset with a configurable batch size like so, and we can easily iterate between each item in the batch. This is useful if we need to recursively unroll the entire batch in the time dimension for example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DataLoader</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cnt</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">imgs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;front&#39;</span><span class="p">:</span> <span class="s1">&#39;images/front/img_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;rear&#39;</span><span class="p">:</span> <span class="s1">&#39;images/rear/img_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_size</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cnt</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># image filenames</span>
        <span class="n">img_fnames</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="o">.</span><span class="n">list_stack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">cnt</span><span class="o">.</span><span class="n">imgs</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">fname</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">fname</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
            <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_batch_size</span><span class="p">)],</span> <span class="mi">0</span>
        <span class="p">)</span>

        <span class="c1"># load from disk</span>
        <span class="n">loaded_imgs</span> <span class="o">=</span> <span class="n">img_fnames</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">fnames</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">],</span> <span class="mi">0</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">()</span>

        <span class="c1"># update count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">%=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_size</span>

        <span class="c1"># return batch</span>
        <span class="n">cnt</span><span class="o">.</span><span class="n">imgs</span> <span class="o">=</span> <span class="n">loaded_imgs</span>
        <span class="k">return</span> <span class="n">cnt</span>

<span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">batch</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">loader</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">batch</span><span class="o">.</span><span class="n">imgs</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">batch</span><span class="o">.</span><span class="n">imgs</span><span class="o">.</span><span class="n">rear</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">batch_slice</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">batch_slice</span><span class="o">.</span><span class="n">imgs</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">batch_slice</span><span class="o">.</span><span class="n">imgs</span><span class="o">.</span><span class="n">rear</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="network-weights">
<h2>Network weights<a class="headerlink" href="#network-weights" title="Permalink to this heading"></a></h2>
<p>Finally, the Ivy Containers can also be used for storing network weights. In fact, as is discussed in the documentation for the Ivy stateful API, this is how the <code class="code docutils literal notranslate"><span class="pre">ivy.Module</span></code> class stores all trainable variables in the model. The following code is possible thanks to the recursive operation of the container, which applies the gradient update to all variable arrays in the container recursively.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear0</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear1</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linear0</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ivy</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linear1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">()</span>
<span class="n">x_in</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">])</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">])</span>
<span class="n">lr</span> <span class="o">=</span> <span class="mf">0.001</span>

<span class="k">def</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">x_in</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ivy</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">((</span><span class="n">out</span> <span class="o">-</span> <span class="n">target</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">loss</span><span class="p">,</span> <span class="n">grads</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">execute_with_gradients</span><span class="p">(</span>
      <span class="n">loss_fn</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">v</span> <span class="o">-</span> <span class="n">lr</span> <span class="o">*</span> <span class="n">grads</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;step </span><span class="si">{}</span><span class="s1"> loss </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
      <span class="n">step</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>

<span class="p">{</span>
    <span class="n">linear0</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">b</span><span class="p">:</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="o">&gt;</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">64</span><span class="p">]),</span>
        <span class="n">w</span><span class="p">:</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="o">&gt;</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="p">},</span>
    <span class="n">linear1</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">b</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mf">0.0145</span><span class="p">],</span> <span class="n">grad_fn</span><span class="o">=&lt;</span><span class="n">AddBackward0</span><span class="o">&gt;</span><span class="p">),</span>
        <span class="n">w</span><span class="p">:</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="o">&gt;</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Round Up</strong></p>
<p>That should hopefully be enough to get you started with the <code class="code docutils literal notranslate"><span class="pre">ivy.Container</span></code> class 😊</p>
<p>Please check out the discussions on the <a class="reference external" href="https://github.com/unifyai/ivy">repo</a> for FAQs, and reach out on <a class="reference external" href="https://discord.gg/ZVQdvbzNQJ">discord</a> if you have any questions!</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../ivy_as_a_framework.html" class="btn btn-neutral float-left" title="Ivy as a Framework" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ivy_stateful_api.html" class="btn btn-neutral float-right" title="Ivy Stateful API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2022, Ivy Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>